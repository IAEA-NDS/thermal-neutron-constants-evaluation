	program thermalcst
	implicit none
	integer   :: i
        real      :: msc(100)
        real      :: Xf(300),Xc(300),Xs(300),Nu(300),gff(300),gfc(300)
        real      :: alpha(300),eta(300),ABS(300)
        real      :: Prod(300),ProdR(300)
        real      :: RNu(300),R5Nu(300)
        real      :: FH1(300)
        real      :: SCR(300)
        real      :: DXs(300)
        real      :: R5Xf(300),R9Xf(300)
	real      :: FA(300),FF(300),CAP(300),ALPH(300)
        real      :: F1eta(300),F2eta(300),K1(300)
        real      :: FFH(300)
        real      :: FLEM,F1BIG,F1HLF,F2HLF,F3HLF
        real      :: R5FA(300),R5FF(300),R9FF(300)
        real      :: R5F1eta(300),R5F2eta(300),R5K1(300),R9K1(300)  
	

! read parameters: xs, nu, gfactor, ...

	open(1,File="thermalcst.inp")
	do i=1,65
	 read(1,*)msc(i)
        enddo
	close(1)

! Derived mic functions

	gfc(233)=msc(1)
	gfc(235)=msc(7)
	gfc(239)=msc(13)
	gfc(241)=msc(19)

	gff(233)=msc(2)
	gff(235)=msc(8)
	gff(239)=msc(14)
	gff(241)=msc(20)

	Xs(233)=msc(3)*msc(43)
	Xs(235)=msc(9)*msc(49)
	Xs(239)=msc(15)*msc(55)
	Xs(241)=msc(21)*msc(61)

	Xf(233)=msc(4)*msc(44)
	Xf(235)=msc(10)*msc(50)
	Xf(239)=msc(16)*msc(56)
	Xf(241)=msc(22)*msc(62)

	Xc(233)=msc(5)*msc(45)
	Xc(235)=msc(11)*msc(51)
	Xc(239)=msc(17)*msc(57)
	Xc(241)=msc(23)*msc(63)

	Nu(233)=msc(6)*msc(46)
	Nu(235)=msc(12)*msc(52)
	Nu(239)=msc(18)*msc(58)
	Nu(241)=msc(24)*msc(64)
	Nu(252)=msc(25)*msc(65)
	
	alpha(233)=Xc(233)/Xf(233)
	alpha(235)=Xc(235)/Xf(235)
	alpha(239)=Xc(239)/Xf(239)
	alpha(241)=Xc(241)/Xf(241)

	ABS(233)=Xc(233)+Xf(233)
	ABS(235)=Xc(235)+Xf(235)
	ABS(239)=Xc(239)+Xf(239)
	ABS(241)=Xc(241)+Xf(241)

	SCR(233)=msc(36)*Xs(233)
	SCR(235)=msc(37)*Xs(235)
	SCR(239)=msc(38)*Xs(239)
	SCR(241)=msc(39)*Xs(241)

	ProdR(233)=ABS(233)+SCR(233)
	ProdR(235)=ABS(235)+SCR(235)
	ProdR(239)=ABS(239)+SCR(239)
	ProdR(241)=ABS(241)+SCR(241)

	Prod(233)=ABS(233)+Xs(233)
	Prod(235)=ABS(235)+Xs(235)
	Prod(239)=ABS(239)+Xs(239)
	Prod(241)=ABS(241)+Xs(241)
	
	DXs(233)=Prod(233)-ProdR(233)
	DXs(235)=Prod(235)-ProdR(235)
	DXs(239)=Prod(239)-ProdR(239)
	DXs(141)=Prod(241)-ProdR(241)

	FH1(233)=Xf(233)*msc(32)	
	FH1(235)=Xf(235)*msc(33)	
	FH1(239)=Xf(239)*msc(34)	
	FH1(241)=Xf(241)*msc(35)	
		
	R5Xf(233)=Xf(233)/Xf(235)
	R5Xf(235)=Xf(235)/Xf(235)
	R5Xf(239)=Xf(239)/Xf(235)
	R5Xf(241)=Xf(241)/Xf(235)

	R9Xf(233)=Xf(233)/Xf(239)
	R9Xf(235)=Xf(235)/Xf(239)
	R9Xf(239)=Xf(239)/Xf(239)
	R9Xf(241)=Xf(241)/Xf(239)

	RNu(233)=Nu(233)/Nu(252)
	RNu(235)=Nu(235)/Nu(252)
	RNu(239)=Nu(239)/Nu(252)
	RNu(241)=Nu(241)/Nu(252)
	
	R5Nu(233)=Nu(233)/Nu(235)
	R5Nu(235)=Nu(235)/Nu(235)
	R5Nu(239)=Nu(239)/Nu(235)
	R5Nu(241)=Nu(241)/Nu(235)
	
	eta(233)=Nu(233)*Xf(233)/ABS(233)
	eta(235)=Nu(235)*Xf(235)/ABS(235)
	eta(239)=Nu(239)*Xf(239)/ABS(239)
	eta(241)=Nu(241)*Xf(241)/ABS(241)
	
! save mic functions

	open(2,file='thermalcst_mic.out')	
        write(2,*)'21 ',alpha(233)
        write(2,*)'22 ',alpha(235)
        write(2,*)'23 ',alpha(239)
        write(2,*)'54 ',gfc(233)
        write(2,*)'55 ',gfc(235)
        write(2,*)'56 ',gfc(239)
        write(2,*)'57 ',gfc(241)
        write(2,*)'58 ',gff(233)
        write(2,*)'59 ',gff(235)
        write(2,*)'60 ',gff(239)
        write(2,*)'61 ',gff(241)
        write(2,*)'62 ',ProdR(235)	
        write(2,*)'63 ',ProdR(235)	
        write(2,*)'64 ',ProdR(235)	
        write(2,*)'65 ',Prod(235)	
        write(2,*)'66 ',ProdR(235)	
        write(2,*)'67 ',Prod(235)	
        write(2,*)'68 ',ProdR(235)	
        write(2,*)'69 ',ProdR(235)	
        write(2,*)'70 ',ProdR(235)	
        write(2,*)'71 ',ABS(235)	
        write(2,*)'72 ',ProdR(239)	
        write(2,*)'73 ',Prod(239)	
        write(2,*)'74 ',ProdR(239)	
        write(2,*)'75 ',ProdR(239)	
        write(2,*)'76 ',ProdR(239)	
        write(2,*)'77 ',ProdR(233)	
        write(2,*)'78 ',ProdR(233)	
        write(2,*)'79 ',ProdR(233)	
        write(2,*)'80 ',ABS(233)	
        write(2,*)'81 ',ProdR(233)	
        write(2,*)'82 ',Prod(233)	
        write(2,*)'83 ',ProdR(233)	
        write(2,*)'84 ',ProdR(233)	
        write(2,*)'85 ',Prod(241)	
        write(2,*)'86 ',Prod(241)	
        write(2,*)'87 ',ProdR(241)	
        write(2,*)'88 ',Xs(233)	
        write(2,*)'89 ',DXs(233)	
        write(2,*)'90 ',Xs(235)	
        write(2,*)'91 ',DXs(235)	
        write(2,*)'92 ',Xs(239)	
        write(2,*)'94 ',Xs(241)	
        write(2,*)'96 ',FH1(239)	
        write(2,*)'97 ',FH1(235)	
        write(2,*)'98 ',Xf(235)	
        write(2,*)'99 ',R5Xf(239)	
        write(2,*)'100 ',R5Xf(241)	
        write(2,*)'101 ',FH1(235)	
        write(2,*)'102 ',FH1(233)	
        write(2,*)'103 ',Xf(235)	
        write(2,*)'104 ',FH1(239)	
        write(2,*)'105 ',R9Xf(241)	
        write(2,*)'106 ',Xf(235)	
        write(2,*)'107 ',Xf(235)	
        write(2,*)'108 ',Xf(241)	
        write(2,*)'109 ',FH1(239)/FH1(235)	
        write(2,*)'110 ',FH1(239)/FH1(235)
        write(2,*)'111 ',Nu(252)
        write(2,*)'112 ',RNu(233)
        write(2,*)'113 ',RNu(235)
        write(2,*)'114 ',RNu(239)
        write(2,*)'115 ',RNu(241)
        write(2,*)'116 ',Nu(252)
        write(2,*)'117 ',RNu(233)
        write(2,*)'118 ',RNu(235)
        write(2,*)'119 ',RNu(239)
        write(2,*)'120 ',RNu(241)
        write(2,*)'121 ',Nu(252)
        write(2,*)'122 ',RNu(233)
        write(2,*)'123 ',RNu(235)
        write(2,*)'124 ',RNu(239)
        write(2,*)'125 ',Nu(252)
        write(2,*)'126 ',RNu(235)
        write(2,*)'127 ',Nu(252)
        write(2,*)'128 ',Nu(252)
        write(2,*)'129 ',Nu(252)
        write(2,*)'130 ',Nu(252)
        write(2,*)'131 ',R5Nu(233)
        write(2,*)'132 ',R5Nu(239)
        write(2,*)'133 ',R5Nu(241)
        write(2,*)'134 ',RNu(235)
        write(2,*)'135 ',RNu(233)
        write(2,*)'136 ',RNu(235)
        write(2,*)'137 ',RNu(239)
        write(2,*)'138 ',Nu(252)
        write(2,*)'139 ',Nu(252)
        write(2,*)'140 ',Nu(252)
        write(2,*)'141 ',Nu(252)
        write(2,*)'142 ',Nu(252)
        write(2,*)'143 ',Nu(252)
        write(2,*)'144 ',Nu(252)
        write(2,*)'145 ',eta(233)
        write(2,*)'146 ',eta(235)
        write(2,*)'147 ',eta(239)
        write(2,*)'148 ',eta(241)
        write(2,*)'149 ',eta(233)
        write(2,*)'150 ',eta(235)     	
        write(2,*)'151 ',eta(239)
        write(2,*)'165 ',eta(239)/Xf(239)
        write(2,*)'166 ',ProdR(235)
        write(2,*)'167 ',ProdR(239)
        write(2,*)'168 ',Xs(235)
        write(2,*)'169 ',Nu(233)
        write(2,*)'170 ',Nu(235)
        write(2,*)'171 ',alpha(235)
	close(2)
	
! Derived mac functions
	
	FA(233)=ABS(233)*gfc(233)
	FA(235)=ABS(235)*gfc(235)
	FA(239)=ABS(239)*gfc(239)
	FA(241)=ABS(241)*gfc(241)
	
	FF(233)=Xf(233)*gff(233)
	FF(235)=Xf(235)*gff(235)
	FF(239)=Xf(239)*gff(239)
	FF(241)=Xf(241)*gff(241)
	
	CAP(233)=FA(233)-FF(233)
	CAP(235)=FA(235)-FF(235)
	CAP(239)=FA(239)-FF(239)
	CAP(241)=FA(241)-FF(241)
	CAP(234)=msc(40)
	
	R5FA(233)=FA(233)/FA(235)
	R5FA(235)=FA(235)/FA(235)
	R5FA(239)=FA(239)/FA(235)
	R5FA(241)=FA(241)/FA(235)

	R5FF(233)=FF(233)/FF(235)
	R5FF(235)=FF(235)/FF(235)
	R5FF(239)=FF(239)/FF(235)
	R5FF(241)=FF(241)/FF(235)

	R9FF(233)=FF(233)/FF(239)
	R9FF(235)=FF(235)/FF(239)
	R9FF(239)=FF(239)/FF(239)
	R9FF(241)=FF(241)/FF(239)

	ALPH(233)=CAP(233)/FF(233)
        ALPH(235)=CAP(235)/FF(235)
        ALPH(239)=CAP(239)/FF(239)
        ALPH(241)=CAP(241)/FF(241)

	F1eta(233)=Nu(233)*FF(233)/FA(233)
	F1eta(235)=Nu(235)*FF(235)/FA(235)
	F1eta(239)=Nu(239)*FF(239)/FA(239)
	F1eta(241)=Nu(241)*FF(241)/FA(241)

	R5F1eta(233)=F1eta(233)/F1eta(235)
	R5F1eta(235)=F1eta(235)/F1eta(235)
	R5F1eta(239)=F1eta(239)/F1eta(235)
	R5F1eta(241)=F1eta(241)/F1eta(235)

	F2eta(233)=Nu(233)*FF(233)
	F2eta(235)=Nu(235)*FF(235)
	F2eta(239)=Nu(239)*FF(239)
	F2eta(241)=Nu(241)*FF(241)

	R5F2eta(233)=F2eta(233)/F2eta(235)
	R5F2eta(235)=F2eta(235)/F2eta(235)
	R5F2eta(239)=F2eta(239)/F2eta(235)
	R5F2eta(241)=F2eta(241)/F2eta(235)

	K1(233)=Nu(233)*FF(233)-FA(233)
	K1(235)=Nu(235)*FF(235)-FA(235)
	K1(239)=Nu(239)*FF(239)-FA(239)
	K1(241)=Nu(241)*FF(241)-FA(241)

	R5K1(233)=K1(233)/K1(235)
	R5K1(235)=K1(235)/K1(235)
	R5K1(239)=K1(239)/K1(235)
	R5K1(241)=K1(241)/K1(235)
	
	R9K1(233)=K1(233)/K1(239)
	R9K1(235)=K1(235)/K1(239)
	R9K1(239)=K1(239)/K1(239)
	R9K1(241)=K1(241)/K1(239)
	
	FFH(233)=FF(233)*msc(32)	
	FFH(235)=FF(235)*msc(34)	
	FFH(239)=FF(239)*msc(34)	
	FFH(241)=FF(241)*msc(35)

	FLEM=CAP(233)/(FA(233)-CAP(234))
	F1HLF=1.0+(0.12966*(msc(35)-14.05))
	F2HLF=1.0+(0.0225*(msc(35)-14.05))
	F3HLF=1.0+(0.00395*(14.5-msc(35))/(14.5-12.9))
	F1BIG=FF(241)/(FFH(239)*F3HLF)

! save mic functions

	open(2,file='thermalcst_mac.out')	
        write(2,*)'1 ',R5FA(239)
        write(2,*)'2 ',CAP(239)
        write(2,*)'3 ',CAP(233)
        write(2,*)'4 ',FLEM
        write(2,*)'5 ',CAP(234)
        write(2,*)'6 ',FF(235)
        write(2,*)'7 ',FFH(233)
        write(2,*)'8 ',FFH(233)
        write(2,*)'9 ',FF(235)*msc(32)
        write(2,*)'10 ',FFH(239)
        write(2,*)'11 ',FFH(233)
        write(2,*)'12 ',R9FF(241)
        write(2,*)'13 ',R5FF(239)
        write(2,*)'14 ',R5FF(241)
        write(2,*)'15 ',R5FF(233)
        write(2,*)'16 ',R5FF(233)
        write(2,*)'17 ',FFH(239)/FFH(235)
        write(2,*)'18 ',FFH(239)/FFH(233)
        write(2,*)'19 ',FFH(239)/(FF(235)*msc(32))
        write(2,*)'20 ',F1BIG
        write(2,*)'24 ',ALPH(233)
        write(2,*)'25 ',ALPH(235)
        write(2,*)'26 ',ALPH(233)
        write(2,*)'27 ',ALPH(235)
        write(2,*)'28 ',ALPH(233)
        write(2,*)'29 ',ALPH(235)
        write(2,*)'30 ',ALPH(233)
        write(2,*)'31 ',ALPH(235)
        write(2,*)'32 ',ALPH(235)
        write(2,*)'33 ',ALPH(239)
        write(2,*)'34 ',ALPH(233)
        write(2,*)'35 ',ALPH(235)
        write(2,*)'36 ',ALPH(239)
        write(2,*)'37 ',R5F1eta(233)
        write(2,*)'38 ',R5F1eta(239)
        write(2,*)'39 ',R5F1eta(241)
        write(2,*)'40 ',R5K1(233)
        write(2,*)'41 ',R5K1(239)
        write(2,*)'42 ',R5K1(233)
        write(2,*)'43 ',R5K1(239)
        write(2,*)'44 ',R5F2eta(233)
        write(2,*)'45 ',R5F2eta(239)
        write(2,*)'46 ',K1(233)
        write(2,*)'47 ',K1(235)
        write(2,*)'48 ',R5K1(239)
        write(2,*)'49 ',R9K1(241)
        write(2,*)'50 ',R5K1(233)
        write(2,*)'51 ',R5K1(239)
        write(2,*)'52 ',R5K1(233)
        write(2,*)'53 ',R5K1(239)
	close(2)


	end
	
